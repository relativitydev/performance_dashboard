namespace kCura.PDB.Service.Tests.Logic.Metrics.UserExperience
{
	using System;
	using System.Collections.Generic;
	using System.Text.RegularExpressions;
	using System.Xml.Linq;
	using kCura.PDB.Core.Enumerations;
	using kCura.PDB.Core.Interfaces.Services;
	using kCura.PDB.Service.Audits;
	using Moq;
	using NUnit.Framework;

	[TestFixture, Category("Unit")]
	public class AuditParsingServiceTests
	{
		private AuditParsingService auditParsingService;
		private Mock<ILogger> loggerMock;

		[SetUp]
		public void SetUp()
		{
			this.loggerMock = new Mock<ILogger>();
			this.auditParsingService = new AuditParsingService(this.loggerMock.Object);
		}

		[Test]
		[TestCase(AuditTestCase, "52b60df4-9476-4aab-a2ec-55474cd230ec")]
		[TestCase(AuditTestCaseInvalidChars, "52b60df4-9476-4aab-a2ec-55474cd230ec")]
		public void ParseRawQueryId_Success(string xmlString, string expectedQueryId)
		{
			// Arrange
			// Act
			var results = this.auditParsingService.ParseRawQueryId(xmlString);
			
			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryId));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(DataGridAuditTestCase, "42fbbcec-4394-4049-b07e-35967d6f1829")]
		[TestCase(DataGridAuditTestCaseInvalidChars, "42fbbcec-4394-4049-b07e-35967d6f1829")]
		public void ParseQueryId_Success(string xmlString, string expectedQueryId)
		{
			// Arrange
			// Act
			var results = this.auditParsingService.ParseQueryId(xmlString);

			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryId));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(AuditTestCase, AuditTestCaseQueryText)]
		[TestCase(AuditTestCaseInvalidChars, AuditTestCaseQueryText)]
		public void ParseRawQueryText_Success(string xmlString, string expectedQueryText)
		{
			// Arrange
			xmlString = string.Join(" ", Regex.Split(xmlString, @"(?:\r\n|\n|\r)")); // Dealing with different line endings
			expectedQueryText = string.Join(" ", Regex.Split(expectedQueryText, @"(?:\r\n|\n|\r)")); // Dealing with different line endings

			// Act
			var results = this.auditParsingService.ParseRawQueryText(xmlString);

			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryText));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(DataGridAuditTestCase, DataGridAuditTestCaseQueryText)]
		[TestCase(DataGridAuditTestCaseInvalidChars, DataGridAuditTestCaseQueryText)]
		public void ParseQueryText_Success(string xmlString, string expectedQueryText)
		{
			// Arrange
			xmlString = string.Join(" ", Regex.Split(xmlString, @"(?:\r\n|\n|\r)")); // Dealing with different line endings
			expectedQueryText = string.Join(" ", Regex.Split(expectedQueryText, @"(?:\r\n|\n|\r)")); // Dealing with different line endings

			// Act
			var results = this.auditParsingService.ParseQueryText(xmlString);

			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryText));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(AuditTestCase, QueryType.IdList)]
		[TestCase(AuditTestCaseInvalidChars, QueryType.IdList)]
		public void ParseQueryType_Success(string xmlString, QueryType? expectedQueryType)
		{
			// Arrange
			// Act
			var results = this.auditParsingService.ParseRawQueryType(xmlString);

			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryType));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(DataGridAuditTestCase, QueryType.IdList)]
		[TestCase(DataGridAuditTestCaseInvalidChars, QueryType.IdList)]
		public void ParseQueryType_DataGrid_Success(string xmlString, QueryType? expectedQueryType)
		{
			// Arrange
			// Act
			var results = this.auditParsingService.ParseQueryType(xmlString);

			// Assert
			Assert.That(results, Is.Not.Null);
			Assert.That(results, Is.EqualTo(expectedQueryType));
			this.loggerMock.VerifyAll();
		}

		[Test]
		[TestCase(ProblematicAuditD, true)]
		[TestCase(ProblematicAuditA, true)]
		[TestCase(ProblematicAuditB, true)]
		[TestCase(ProblematicAuditC, true)]
		[TestCase(AuditTestCase, true)]
		[TestCase(AuditTestCaseInvalidChars, true)]
		[TestCase(DataGridAuditTestCase, false)]
		[TestCase(DataGridAuditTestCaseInvalidChars, false)]
		public void Parse_Resolve(string xmlString, bool rawQuery)
		{
			// Arrange
			// Act
			if (rawQuery)
			{
				var queryIdResultRaw = this.auditParsingService.ParseRawQueryId(xmlString);
				var queryTextResultRaw = this.auditParsingService.ParseRawQueryText(xmlString);
				var queryTypeResultRaw = this.auditParsingService.ParseRawQueryType(xmlString);
			}
			else
			{
				var queryTypeResult = this.auditParsingService.ParseQueryType(xmlString);
				var queryIdResult = this.auditParsingService.ParseQueryId(xmlString);
				var queryTextResult = this.auditParsingService.ParseQueryText(xmlString);
			}

			// Assert
			this.loggerMock.VerifyAll();
			Assert.Pass();
		}

		[Test]
		public void Parse_Failure()
		{
			// Arrange
			var badXmlString = "=ThisisNotXML";
			XDocument doc;
			this.loggerMock.Setup(m=>m.LogError(It.IsAny<string>(), It.IsAny<Exception>(), It.IsAny<List<string>>())).Verifiable("Failed To Verify LogError mock");

			// Act
			var result = this.auditParsingService.TryParse(badXmlString, out doc);

			// Assert
			Assert.That(result, Is.False);
			Assert.That(doc, Is.Null);
			this.loggerMock.VerifyAll();
		}

		private const string AuditTestCase = "<auditElement><QueryText>/* &lt;Comments&gt;\r\n  &lt;ArtifactID /&gt;\r\n  &lt;ArtifactTypeID&gt;10&lt;/ArtifactTypeID&gt;\r\n  &lt;UserID&gt;1000000000&lt;/UserID&gt;\r\n  &lt;WorkspaceID&gt;1052594&lt;/WorkspaceID&gt;\r\n  &lt;QueryType&gt;IdList&lt;/QueryType&gt;\r\n  &lt;QueryID&gt;52b60df4-9476-4aab-a2ec-55474cd230ec&lt;/QueryID&gt;\r\n  &lt;QuerySource&gt;Ad Hoc Search&lt;/QuerySource&gt;\r\n&lt;/Comments&gt; */\r\n\r\nSET NOCOUNT ON \r\nSELECT TOP 1000\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n((NOT ([Document].[BatesBeg] IS NULL OR [Document].[BatesBeg] = N'') \r\nAND \r\n[Document].[BatesBeg] IN (N'sdfasdfsadfasdf')) \r\nAND \r\nNOT ([Document].[ExtractedText] IS NULL OR [Document].[ExtractedText] = N''))\r\nORDER BY \r\n\t[Document].[ArtifactID] \r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n</QueryText><Milliseconds>750</Milliseconds></auditElement>";
		private const string AuditTestCaseInvalidChars = "<auditElement><QueryText>/* &lt;Comments&gt;\r\n  &lt;ArtifactID /&gt;\r\n  &lt;ArtifactTypeID&gt;10&lt;/ArtifactTypeID&gt;\r\n  &lt;UserID&gt;1000000000&lt;/UserID&gt;\r\n  &lt;WorkspaceID&gt;1052594&lt;/WorkspaceID&gt;\r\n  &lt;QueryType&gt;IdList&lt;/QueryType&gt;\r\n  &lt;QueryID&gt;52b60df4-9476-4aab-a2ec-55474cd230ec&lt;/QueryID&gt;\r\n  &lt;QuerySource&gt;Ad Hoc Search&lt;/QuerySource&gt;\r\n&lt;/Comments&gt; */\r\n\u000B\u000B\u000B\r\nSET NOCOUNT ON \r\nSELECT TOP 1000\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n((NOT ([Document].[BatesBeg] IS NULL OR [Document].[BatesBeg] = N'') \r\nAND \r\n[Document].[BatesBeg] IN (N'sdfasdfsadfasdf')) \r\nAND \r\nNOT ([Document].[ExtractedText] IS NULL OR [Document].[ExtractedText] = N''))\r\nORDER BY \r\n\t[Document].[ArtifactID] \r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n</QueryText><Milliseconds>750</Milliseconds></auditElement>";
		private const string AuditTestCaseQueryText = "\r\n\r\nSET NOCOUNT ON \r\nSELECT TOP 1000\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n((NOT ([Document].[BatesBeg] IS NULL OR [Document].[BatesBeg] = N'') \r\nAND \r\n[Document].[BatesBeg] IN (N'sdfasdfsadfasdf')) \r\nAND \r\nNOT ([Document].[ExtractedText] IS NULL OR [Document].[ExtractedText] = N''))\r\nORDER BY \r\n\t[Document].[ArtifactID] \r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n";

		private const string DataGridAuditTestCase = "/* <Comments>\r\n  <ArtifactID />\r\n  <ArtifactTypeID>10</ArtifactTypeID>\r\n  <UserID>777</UserID>\r\n  <WorkspaceID>1204161</WorkspaceID>\r\n  <QueryType>IdList</QueryType>\r\n  <QueryID>42fbbcec-4394-4049-b07e-35967d6f1829</QueryID>\r\n  <QuerySource>Ad Hoc Search</QuerySource>\r\n</Comments> */\r\n\r\nSET NOCOUNT ON \r\nSELECT TOP 1\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nLEFT JOIN [ExtendedArtifact] (NOLOCK) ON \r\n\t[ExtendedArtifact].[ArtifactID] = [Document].[ArtifactID]\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n(([ExtendedArtifact].[CreatedOn] IS NOT NULL \r\nAND \r\n(([ExtendedArtifact].[CreatedOn] > '20180304 01:51:24.697'))) \r\nAND \r\n[Document].[ArtifactID] IN (SELECT \r\n\t[DataGridFileMapping].[ArtifactID]\r\n\r\nFROM\r\n\t[DataGridFileMapping] (NOLOCK)\r\nWHERE\r\n[DataGridFileMapping].[FieldArtifactID] = 1003668\r\nAND\r\n[DataGridFileMapping].[FileSize] IS NOT NULL\r\nAND\r\n[DataGridFileMapping].[FileSize] > 0\r\n))\r\nORDER BY \r\n\t[Document].[ArtifactID] ASC\r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n";
		private const string DataGridAuditTestCaseInvalidChars = "/* \x0B\x0B<Comments>\r\n  \x0B\x0B<ArtifactID />\r\n  <ArtifactTypeID>10</ArtifactTypeID>\r\n  <UserID>777</UserID>\r\n  <WorkspaceID>1204161</WorkspaceID>\r\n  <QueryType>IdList</QueryType>\r\n  <QueryID>42fbbcec-4394-4049-b07e-35967d6f1829</QueryID>\r\n  <QuerySource>Ad Hoc Search</QuerySource>\r\n</Comments> */\r\n\r\nSET NOCOUNT ON \r\nSELECT TOP 1\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nLEFT JOIN [ExtendedArtifact] (NOLOCK) ON \x0B\x0B\r\n\t[ExtendedArtifact].[ArtifactID] = [Document].[ArtifactID]\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n(([ExtendedArtifact].[CreatedOn] IS NOT NULL \r\nAND \r\n(([ExtendedArtifact].[CreatedOn] > '20180304 01:51:24.697')))\x0B \r\nAND \r\n[Document].[ArtifactID] IN (SELECT \r\n\t[DataGridFileMapping].[ArtifactID]\r\n\r\nFROM\r\n\t[DataGridFileMapping] (NOLOCK)\r\nWHERE\r\n[DataGridFileMapping].[FieldArtifactID] = 1003668\r\nAND\r\n[DataGridFileMapping].[FileSize] IS NOT NULL\r\nAND\r\n[DataGridFileMapping].[FileSize] > 0\r\n))\r\nORDER BY \r\n\t[Document].[ArtifactID] ASC\r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n";
		private const string DataGridAuditTestCaseQueryText = "\r\n\r\nSET NOCOUNT ON \r\nSELECT TOP 1\r\n\t[Document].[ArtifactID]\r\n\r\nFROM\r\n\t[Document] (NOLOCK)\r\nLEFT JOIN [ExtendedArtifact] (NOLOCK) ON \r\n\t[ExtendedArtifact].[ArtifactID] = [Document].[ArtifactID]\r\nWHERE\r\n[Document].[AccessControlListID_D] IN (1)\r\nAND\r\n(([ExtendedArtifact].[CreatedOn] IS NOT NULL \r\nAND \r\n(([ExtendedArtifact].[CreatedOn] > '20180304 01:51:24.697'))) \r\nAND \r\n[Document].[ArtifactID] IN (SELECT \r\n\t[DataGridFileMapping].[ArtifactID]\r\n\r\nFROM\r\n\t[DataGridFileMapping] (NOLOCK)\r\nWHERE\r\n[DataGridFileMapping].[FieldArtifactID] = 1003668\r\nAND\r\n[DataGridFileMapping].[FileSize] IS NOT NULL\r\nAND\r\n[DataGridFileMapping].[FileSize] > 0\r\n))\r\nORDER BY \r\n\t[Document].[ArtifactID] ASC\r\n\r\n\r\n-------------------\r\n-- records returned: 0\r\n-------------------\r\n";


		private const string ProblematicAuditA =
			@"<auditElement><field id=""1293533"" type=""5"" name=""Account Name"" formatstring=""""><setChoice>1295230</setChoice><unsetChoice>1295230</unsetChoice></field><field id=""1293538"" type=""5"" name=""Account Type"" formatstring=""""><setChoice>1293795</setChoice><unsetChoice>1293795</unsetChoice></field><field id=""1293530"" type=""5"" name=""Assigned to Pod"" formatstring=""""><setChoice>1293792</setChoice><unsetChoice>1293792</unsetChoice></field><field id=""1293506"" type=""2"" name=""Closed Date"" formatstring=""""><oldValue>2017-09-07 18:13:31</oldValue><newValue>2017-09-07 18:13:00</newValue></field><field id=""1293540"" type=""0"" name=""Contact Email"" formatstring=""""><oldValue><![CDATA[nspooner@gardere.com]]></oldValue><newValue><![CDATA[nspooner@gardere.com]]></newValue></field><field id=""1293534"" type=""0"" name=""Contact Name"" formatstring=""""><oldValue><![CDATA[Nathan Spooner]]></oldValue><newValue><![CDATA[Nathan Spooner]]></newValue></field><field id=""1293539"" type=""0"" name=""Contact Phone"" formatstring=""""><oldValue><![CDATA[+12149994817]]></oldValue><newValue><![CDATA[+12149994817]]></newValue></field><field id=""1293505"" type=""2"" name=""Created Date"" formatstring=""""><oldValue>2017-08-30 21:10:21</oldValue><newValue>2017-08-30 21:10:00</newValue></field><field id=""1293518"" type=""4"" name=""Description"" formatstring=""""><oldValue><![CDATA[Eror building an index.]]></oldValue><newValue><![CDATA[Eror building an index.]]></newValue></field><field id=""1293542"" type=""4"" name=""Error"" formatstring=""""><oldValue><![CDATA[Error from Agent:    The Relativity Analytics Server could not query your Relativity Database. Have you run the Relativity Analytics Server Installer on this Analytics Server? If so, have you given it the password for this Relativity Instance?     Full Text: Analytics.CAATRestWrapper.Exception.RestCallFailureException: The Relativity Analytics Server could not query your Relativity Database. Have you run the Relativity Analytics Server Installer on this Analytics Server? If so, have you given it the password for this Relativity Instance?     at Analytics.CAATRestWrapper.REST.RESTHelper.<ThrowError>d__20.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.REST.RESTHelper.<SendPostRequestAsync>d__14.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.REST.RESTHelper.<SendPostRequestAsync>d__13.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.<ExecuteConnectorOperation>d__23.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.<TestConnectorAsync>d__21.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.TestConnector(String itemID, String connectorID)     at Relativity.Core.ContentAnalystIndexWorker.StartConnector(PopulationQueueItem checkedOutTable, String dataSQL, String serializedDataGridFieldListing, Int32 batchSize, String serializedDataGridAuthSettings)     at Relativity.Core.ContentAnalystIndexWorker.LaunchConnectors(Int32 batchSize, String queueTable)     at Relativity.Core.ContentAnalystIndexWorker.ManageJDBCConnectors(String queueName, ContentAnalystPopulationErrorManager failureManager, Int32 batchSize)     at Relativity.Core.ContentAnalystIndexWorker.Execute(Int32 batchSize)     at Relativity.Core.ContentAnalystIndexer.ExecuteWorker(BaseContentAnalystIndexWorker worker)     at Relativity.Core.ContentAnalystIndexer.DoFullBuild()     at Relativity.Core.ContentAnalystIndexer.DoJob()     at Analytics.Conceptual.Agents.Legacy.VisualBasic.ContentAnalystIndexManager.Execute()       Error from CAAT logs:    1250638_1042971 does not exist. [1250638_1042971]).  Returning the following message in its place: System error: ItemStoreUsageException(INIS0007,1250638_1042971) 2017-08-30 15:59:48.649  2017-08-30 15:59:49,321 <<>> ERROR ConnectorController AUCT0138: Test failed for connector Connector: a0267613-1648-40e4-bce8-4977a474da53 a579729facbd4e5fb8dec13820262358: com.microsoft.sqlserver.jdbc.SQLServerDriver [Connector: a0267613-1648-40e4-bce8-4977a474da53 a579729facbd4e5fb8dec13820262358, com.microsoft.sqlserver.jdbc.SQLServerDriver]  Caused by: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver  2017-08-30 15:59:49,946 <<>> ERROR ConnectorManager AUID0039: 1 is not a recognized connectorId. [1]    --   Error from AnalyticsIndex table:    The Analytics Server could not be reached.  An error occurred while sending the request.]]></oldValue><newValue><![CDATA[Error from Agent:    The Relativity Analytics Server could not query your Relativity Database. Have you run the Relativity Analytics Server Installer on this Analytics Server? If so, have you given it the password for this Relativity Instance?     Full Text: Analytics.CAATRestWrapper.Exception.RestCallFailureException: The Relativity Analytics Server could not query your Relativity Database. Have you run the Relativity Analytics Server Installer on this Analytics Server? If so, have you given it the password for this Relativity Instance?     at Analytics.CAATRestWrapper.REST.RESTHelper.<ThrowError>d__20.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.REST.RESTHelper.<SendPostRequestAsync>d__14.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.REST.RESTHelper.<SendPostRequestAsync>d__13.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.<ExecuteConnectorOperation>d__23.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.<TestConnectorAsync>d__21.MoveNext()  --- End of stack trace from previous location where exception was thrown ---     at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)     at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)     at Analytics.CAATRestWrapper.Managers.BaseIngestionManager.TestConnector(String itemID, String connectorID)     at Relativity.Core.ContentAnalystIndexWorker.StartConnector(PopulationQueueItem checkedOutTable, String dataSQL, String serializedDataGridFieldListing, Int32 batchSize, String serializedDataGridAuthSettings)     at Relativity.Core.ContentAnalystIndexWorker.LaunchConnectors(Int32 batchSize, String queueTable)     at Relativity.Core.ContentAnalystIndexWorker.ManageJDBCConnectors(String queueName, ContentAnalystPopulationErrorManager failureManager, Int32 batchSize)     at Relativity.Core.ContentAnalystIndexWorker.Execute(Int32 batchSize)     at Relativity.Core.ContentAnalystIndexer.ExecuteWorker(BaseContentAnalystIndexWorker worker)     at Relativity.Core.ContentAnalystIndexer.DoFullBuild()     at Relativity.Core.ContentAnalystIndexer.DoJob()     at Analytics.Conceptual.Agents.Legacy.VisualBasic.ContentAnalystIndexManager.Execute()       Error from CAAT logs:    1250638_1042971 does not exist. [1250638_1042971]).  Returning the following message in its place: System error: ItemStoreUsageException(INIS0007,1250638_1042971) 2017-08-30 15:59:48.649  2017-08-30 15:59:49,321 <<>> ERROR ConnectorController AUCT0138: Test failed for connector Connector: a0267613-1648-40e4-bce8-4977a474da53 a579729facbd4e5fb8dec13820262358: com.microsoft.sqlserver.jdbc.SQLServerDriver [Connector: a0267613-1648-40e4-bce8-4977a474da53 a579729facbd4e5fb8dec13820262358, com.microsoft.sqlserver.jdbc.SQLServerDriver]  Caused by: java.lang.ClassNotFoundException: com.microsoft.sqlserver.jdbc.SQLServerDriver  2017-08-30 15:59:49,946 <<>> ERROR ConnectorManager AUID0039: 1 is not a recognized connectorId. [1]    --   Error from AnalyticsIndex table:    The Analytics Server could not be reached.  An error occurred while sending the request.]]></newValue></field><field id=""1293527"" type=""3"" name=""Escalated to Cloud Ops"" formatstring=""""><oldValue>False</oldValue><newValue>False</newValue></field><field id=""1293526"" type=""3"" name=""Escalated to Dev"" formatstring=""""><oldValue>False</oldValue><newValue>False</newValue></field><field id=""1293529"" type=""3"" name=""Escalated to L3"" formatstring=""""><oldValue>False</oldValue><newValue>False</newValue></field><field id=""1293535"" type=""5"" name=""Feature Category"" formatstring=""""><setChoice>1296583</setChoice><unsetChoice>1296583</unsetChoice></field><field id=""1293525"" type=""4"" name=""Issue Description"" formatstring=""""><oldValue></oldValue><newValue></newValue></field><field id=""1293516"" type=""5"" name=""Priority"" formatstring=""""><setChoice>1293718</setChoice><unsetChoice>1293718</unsetChoice></field><field id=""1293536"" type=""5"" name=""Product Category"" formatstring=""""><setChoice>1296494</setChoice><unsetChoice>1296494</unsetChoice></field><field id=""1293537"" type=""0"" name=""Relativity Instance"" formatstring=""""><oldValue><![CDATA[GARDERE01]]></oldValue><newValue><![CDATA[GARDERE01]]></newValue></field><field id=""1293519"" type=""5"" name=""Relativity Version"" formatstring=""""><setChoice>1295013</setChoice><unsetChoice>1295013</unsetChoice></field><field id=""1410582"" type=""5"" name=""RelativityOne"" formatstring=""""></field><field id=""1293524"" type=""4"" name=""Root Cause Description"" formatstring=""""><oldValue><![CDATA[We found the issue was the sqljdbc4.jar file was missing. The CAAT version we provided (3.26.0) did not ship with this file. We upgraded their CAAT release to 3.26.4, which contains the JAR file.]]></oldValue><newValue><![CDATA[We found the issue was the sqljdbc4.jar file was missing. The CAAT version we provided (3.26.0) did not ship with this file. We upgraded their CAAT release to 3.26.4, which contains the JAR file.]]></newValue></field><field id=""1293522"" type=""5"" name=""Route Cause"" formatstring=""""><setChoice>1293829</setChoice><unsetChoice>1293829</unsetChoice></field><field id=""1293541"" type=""5"" name=""Sales Region"" formatstring=""""><setChoice>1293729</setChoice><unsetChoice>1293729</unsetChoice></field><field id=""1293510"" type=""5"" name=""Status"" formatstring=""""><setChoice>1293716</setChoice><unsetChoice>1293716</unsetChoice></field><field id=""1293521"" type=""4"" name=""Status Description"" formatstring=""""><oldValue><![CDATA[We found the issue was the sqljdbc4.jar file was missing. The CAAT version we provided (3.26.0) did not ship with this file, and Nathan should have received the 3.26.4 package, which contains the file. I sent over the 3.26.4 release package over GTA and we upgraded their server to it. We then retried errors and got the index to popualate and build without further error.    I provided Nathan with the 9.4 MSI installer for the check point upgrade of their Production server. From there, Nathan will use the 3.26.4 package to fully upgrade the server. Nathan is all set. Okay to close.]]></oldValue><newValue><![CDATA[We found the issue was the sqljdbc4.jar file was missing. The CAAT version we provided (3.26.0) did not ship with this file, and Nathan should have received the 3.26.4 package, which contains the file. I sent over the 3.26.4 release package over GTA and we upgraded their server to it. We then retried errors and got the index to popualate and build without further error.    I provided Nathan with the 9.4 MSI installer for the check point upgrade of their Production server. From there, Nathan will use the 3.26.4 package to fully upgrade the server. Nathan is all set. Okay to close.]]></newValue></field><field id=""1293514"" type=""0"" name=""Subject"" formatstring=""""><oldValue><![CDATA[Error building analytics index]]></oldValue><newValue><![CDATA[Error building analytics index]]></newValue></field><field id=""1293520"" type=""5"" name=""Support Time Classification"" formatstring=""""><setChoice>1294653</setChoice><unsetChoice>1294653</unsetChoice></field><field id=""1293507"" type=""0"" name=""Ticket Number"" formatstring=""""><oldValue><![CDATA[01446008]]></oldValue><newValue><![CDATA[01446008]]></newValue></field><field id=""1293543"" type=""5"" name=""Ticket Opened"" formatstring=""""><setChoice>1294608</setChoice><unsetChoice>1294608</unsetChoice></field><field id=""1293512"" type=""5"" name=""Ticket Origin"" formatstring=""""><setChoice>1293717</setChoice><unsetChoice>1293717</unsetChoice></field><field id=""1293532"" type=""5"" name=""Ticket Owner"" formatstring=""""><setChoice>1294696</setChoice><unsetChoice>1294696</unsetChoice></field><field id=""1293504"" type=""0"" name=""TicketID"" formatstring=""""><oldValue></oldValue><newValue></newValue></field><field id=""1293508"" type=""5"" name=""Type"" formatstring=""""><setChoice>1293715</setChoice><unsetChoice>1293715</unsetChoice></field></auditElement>";

		private const string ProblematicAuditB = @"<auditElement><field id=""1033806"" type=""9"" name=""FileIcon"" formatstring=""""><oldValue><![CDATA[739943.JPG]]></oldValue></field><field id=""1003667"" type=""0"" name=""Control Number"" formatstring=""""><oldValue><![CDATA[ABE0575554]]></oldValue></field><field id=""1003668"" type=""4"" name=""Extracted Text"" formatstring=""""><oldValue><![CDATA[  ]]></oldValue></field><field id=""1003669"" type=""0"" name=""MD5 Hash"" formatstring=""""><oldValue><![CDATA[42C604BC9B82C8F90C0B2845403EB332]]></oldValue></field><field id=""1003671"" type=""0"" name=""Family Group"" formatstring=""""><oldValue><![CDATA[ABE0575553]]></oldValue></field><field id=""1003672"" type=""5"" name=""Has Images"" formatstring=""""><unsetChoice>1034244</unsetChoice></field><field id=""1003673"" type=""3"" name=""Has Native"" formatstring=""""><oldValue>True</oldValue></field><field id=""1033814"" type=""3"" name=""Production Errors"" formatstring=""""><oldValue></oldValue></field><field id=""1034198"" type=""8"" name=""Markup Set - Primary"" formatstring=""""></field><field id=""1034247"" type=""3"" name=""Supported By Viewer"" formatstring=""""><oldValue>True</oldValue></field><field id=""1034248"" type=""0"" name=""Relativity Native Type"" formatstring=""""><oldValue><![CDATA[JPEG File Interchange]]></oldValue></field><field id=""1035244"" type=""6"" name=""Relativity Native Time Zone Offset"" formatstring=""""><oldValue>0.00</oldValue></field><field id=""1035247"" type=""3"" name=""Has Inline Tags"" formatstring=""""><oldValue></oldValue></field><field id=""1035266"" type=""1"" name=""Relativity Image Count"" formatstring=""""><oldValue></oldValue></field><field id=""1035345"" type=""0"" name=""Bates Beg"" formatstring=""""><oldValue></oldValue></field><field id=""1035346"" type=""0"" name=""Bates End"" formatstring=""""><oldValue></oldValue></field><field id=""1035350"" type=""4"" name=""Conversation Index"" formatstring=""""><oldValue></oldValue></field><field id=""1035352"" type=""2"" name=""Date/Time Created"" formatstring=""g""><oldValue>2005-03-29 13:39:06</oldValue></field><field id=""1035353"" type=""2"" name=""Last Modified Date/Time"" formatstring=""g""><oldValue>2005-03-29 13:39:06</oldValue></field><field id=""1035354"" type=""2"" name=""Date/Time Received"" formatstring=""g""><oldValue></oldValue></field><field id=""1035355"" type=""2"" name=""Date/Time Sent"" formatstring=""g""><oldValue></oldValue></field><field id=""1035356"" type=""3"" name=""Delivery Receipt Requested"" formatstring=""""><oldValue></oldValue></field><field id=""1035357"" type=""5"" name=""Responsive"" formatstring=""""></field><field id=""1035360"" type=""0"" name=""Control Number Beg Attach"" formatstring=""""><oldValue><![CDATA[ABE0575553]]></oldValue></field><field id=""1035361"" type=""0"" name=""Control Number End Attach"" formatstring=""""><oldValue><![CDATA[ABE0575554]]></oldValue></field><field id=""1035362"" type=""0"" name=""File Extension"" formatstring=""""><oldValue><![CDATA[JPG]]></oldValue></field><field id=""1035364"" type=""4"" name=""EMAIL BCC"" formatstring=""""><oldValue></oldValue></field><field id=""1035365"" type=""4"" name=""EMAIL CC"" formatstring=""""><oldValue></oldValue></field><field id=""1035366"" type=""0"" name=""Email From"" formatstring=""""><oldValue></oldValue></field><field id=""1035368"" type=""4"" name=""Email To"" formatstring=""""><oldValue></oldValue></field><field id=""1035369"" type=""4"" name=""Embedded Data Info"" formatstring=""""><oldValue></oldValue></field><field id=""1035370"" type=""0"" name=""Exemptions"" formatstring=""""><oldValue></oldValue></field><field id=""1035372"" type=""0"" name=""Bates End Attach"" formatstring=""""><oldValue></oldValue></field><field id=""1035373"" type=""0"" name=""Bates Beg Attach"" formatstring=""""><oldValue></oldValue></field><field id=""1035374"" type=""0"" name=""File Name"" formatstring=""""><oldValue><![CDATA[0267bg.jpg]]></oldValue></field><field id=""1035375"" type=""6"" name=""File Size"" formatstring=""""><oldValue>12089.00</oldValue></field><field id=""1035377"" type=""8"" name=""Issues"" formatstring=""""></field><field id=""1035380"" type=""1"" name=""Number of Attachments"" formatstring=""""><oldValue></oldValue></field><field id=""1035382"" type=""0"" name=""Original Folder Path"" formatstring=""""><oldValue></oldValue></field><field id=""1035383"" type=""1"" name=""Pages"" formatstring=""""><oldValue></oldValue></field><field id=""1035384"" type=""2"" name=""Sort Date/Time"" formatstring=""g""><oldValue>2005-03-25 00:08:46</oldValue></field><field id=""1035386"" type=""4"" name=""Privilege Description"" formatstring=""""><oldValue></oldValue></field><field id=""1035387"" type=""8"" name=""Privilege"" formatstring=""""></field><field id=""1035388"" type=""2"" name=""Production Create Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1035389"" type=""0"" name=""Production Volume"" formatstring=""""><oldValue></oldValue></field><field id=""1035456"" type=""0"" name=""Conversation Family"" formatstring=""""><oldValue></oldValue></field><field id=""1036486"" type=""13"" name=""OCR Results"" formatstring=""""></field><field id=""1037987"" type=""4"" name=""Attachment List"" formatstring=""""><oldValue></oldValue></field><field id=""1038011"" type=""10"" name=""Time Zone Field"" formatstring=""""><oldValue>1037890</oldValue></field><field id=""1038055"" type=""5"" name=""Confidential"" formatstring=""""></field><field id=""1038060"" type=""2"" name=""Last Printed Date/Time"" formatstring=""g""><oldValue></oldValue></field><field id=""1038061"" type=""0"" name=""File Type"" formatstring=""""><oldValue><![CDATA[JFIF JPEG Bitmap]]></oldValue></field><field id=""1038067"" type=""3"" name=""Sort Date/Time Propagated"" formatstring=""""><oldValue></oldValue></field><field id=""1038073"" type=""4"" name=""Alert"" formatstring=""""><oldValue></oldValue></field><field id=""1038075"" type=""3"" name=""Email Identifier"" formatstring=""""><oldValue></oldValue></field><field id=""1038079"" type=""6"" name=""Extracted Text Size in KB"" formatstring=""""><oldValue>0.01</oldValue></field><field id=""1038081"" type=""4"" name=""Document Folder Path"" formatstring=""""><oldValue></oldValue></field><field id=""1038083"" type=""4"" name=""Subject"" formatstring=""""><oldValue></oldValue></field><field id=""1038112"" type=""13"" name=""Domains (Email BCC)"" formatstring=""""></field><field id=""1038114"" type=""13"" name=""Domains (Email CC)"" formatstring=""""></field><field id=""1038116"" type=""13"" name=""Domains (Email From)"" formatstring=""""></field><field id=""1038118"" type=""13"" name=""Domains (Email To)"" formatstring=""""></field><field id=""1038137"" type=""8"" name=""Data Load Volume"" formatstring=""""></field><field id=""1038138"" type=""2"" name=""Date Data Load"" formatstring=""d""><oldValue></oldValue></field><field id=""1038139"" type=""8"" name=""Print Job"" formatstring=""""></field><field id=""1038149"" type=""5"" name=""Pre-Production"" formatstring=""""></field><field id=""1038150"" type=""5"" name=""Post-Production"" formatstring=""""></field><field id=""1038151"" type=""8"" name=""Case Admin Saved Searches"" formatstring=""""></field><field id=""1038157"" type=""8"" name=""Case Admin Production Volume"" formatstring=""""></field><field id=""1038164"" type=""4"" name=""Attorney Review Comments"" formatstring=""""><oldValue></oldValue></field><field id=""1038342"" type=""4"" name=""Lotus Notes Other Folders"" formatstring=""""><oldValue></oldValue></field><field id=""1038365"" type=""8"" name=""Analytics Index"" formatstring=""""><unsetChoice>1093309</unsetChoice><unsetChoice>1093312</unsetChoice></field><field id=""1038371"" type=""13"" name=""Imaging Set"" formatstring=""""></field><field id=""1038389"" type=""13"" name=""Lists"" formatstring=""""></field><field id=""1038417"" type=""8"" name=""Image QC Status"" formatstring=""""></field><field id=""1038735"" type=""13"" name=""Produced Documents"" formatstring=""""></field><field id=""1039007"" type=""13"" name=""Production"" formatstring=""""></field><field id=""1039324"" type=""10"" name=""Originating Processing Data Source"" formatstring=""""><oldValue>1114797</oldValue></field><field id=""1039325"" type=""13"" name=""Processing Errors"" formatstring=""""></field><field id=""1039328"" type=""0"" name=""Processing duplicate hash"" formatstring=""""><oldValue><![CDATA[7175E287B26F36DC7F52152C3B0F43D023B6A8CA78334D29517D62A54DFC8FA8]]></oldValue></field><field id=""1039329"" type=""1"" name=""Level"" formatstring=""""><oldValue>2</oldValue></field><field id=""1039330"" type=""4"" name=""Virtual path"" formatstring=""""><oldValue><![CDATA[\JBush_New_Source\2016-10-04_20-42-09UTC\JBush\C\!Misc\Jeb Bush Emails.rar\Jeb Bush Emails\2005a_Jan-Mar_GovernFShiavo.pst\FromAutoForward\FromAutoForward1\0000000034FADAD96871D941A7556C85328EB606242E4500.MSG]]></oldValue></field><field id=""1039331"" type=""0"" name=""Container ID"" formatstring=""""><oldValue><![CDATA[0]]></oldValue></field><field id=""1039332"" type=""0"" name=""Container name"" formatstring=""""><oldValue></oldValue></field><field id=""1039333"" type=""0"" name=""Container extension"" formatstring=""""><oldValue></oldValue></field><field id=""1039334"" type=""10"" name=""Custodian"" formatstring=""""><oldValue>1114796</oldValue></field><field id=""1039335"" type=""2"" name=""Last Published On"" formatstring=""g""><oldValue></oldValue></field><field id=""1039336"" type=""0"" name=""Processing File Id"" formatstring=""""><oldValue><![CDATA[766989]]></oldValue></field><field id=""1039337"" type=""10"" name=""Originating Processing Set"" formatstring=""""><oldValue>1114795</oldValue></field><field id=""1039338"" type=""13"" name=""Discover Errors on Child Documents"" formatstring=""""></field><field id=""1039341"" type=""4"" name=""Processing Folder Path"" formatstring=""""><oldValue><![CDATA[\JBush_New_Source\2016-10-04_20-42-09UTC\JBush\C\!Misc\Jeb Bush Emails.rar\Jeb Bush Emails\2005a_Jan-Mar_GovernFShiavo.pst\FromAutoForward\FromAutoForward1]]></oldValue></field><field id=""1039779"" type=""3"" name=""Inclusive Email"" formatstring=""""><oldValue></oldValue></field><field id=""1039780"" type=""0"" name=""Email Action"" formatstring=""""><oldValue></oldValue></field><field id=""1039781"" type=""0"" name=""Email Duplicate ID"" formatstring=""""><oldValue></oldValue></field><field id=""1039782"" type=""3"" name=""Email Duplicate Spare"" formatstring=""""><oldValue></oldValue></field><field id=""1039783"" type=""0"" name=""Textual Near Duplicate Group"" formatstring=""""><oldValue></oldValue></field><field id=""1039784"" type=""0"" name=""Email Thread Group"" formatstring=""""><oldValue></oldValue></field><field id=""1039785"" type=""3"" name=""Textual Near Duplicate Principal"" formatstring=""""><oldValue></oldValue></field><field id=""1039786"" type=""1"" name=""Indentation"" formatstring=""""><oldValue></oldValue></field><field id=""1039787"" type=""4"" name=""Email Threading Display"" formatstring=""""><oldValue></oldValue></field><field id=""1039788"" type=""4"" name=""Email Threading ID"" formatstring=""""><oldValue></oldValue></field><field id=""1039789"" type=""1"" name=""Textual Near Duplicate Similarity"" formatstring=""""><oldValue></oldValue></field><field id=""1039790"" type=""13"" name=""Docs_Languages"" formatstring=""""></field><field id=""1039793"" type=""0"" name=""Primary language"" formatstring=""""><oldValue></oldValue></field><field id=""1039794"" type=""0"" name=""Inclusive Reason"" formatstring=""""><oldValue></oldValue></field><field id=""1039920"" type=""13"" name=""All Custodians"" formatstring=""""></field><field id=""1039933"" type=""4"" name=""All Paths/Locations"" formatstring=""""><oldValue><![CDATA[Lincoln, Abe|\JBush_New_Source\2016-10-04_20-42-09UTC\JBush\C\!Misc\Jeb Bush Emails.rar\Jeb Bush Emails\2005a_Jan-Mar_GovernFShiavo.pst\FromAutoForward\FromAutoForward1]]></oldValue></field><field id=""1039935"" type=""4"" name=""Attachment Document IDs"" formatstring=""""><oldValue></oldValue></field><field id=""1039936"" type=""4"" name=""Conversation"" formatstring=""""><oldValue></oldValue></field><field id=""1039937"" type=""4"" name=""Date Created"" formatstring=""""><oldValue><![CDATA[3/29/2005]]></oldValue></field><field id=""1039939"" type=""4"" name=""Created Time"" formatstring=""""><oldValue><![CDATA[01:39:06 PM]]></oldValue></field><field id=""1039940"" type=""13"" name=""DeDuped Custodians"" formatstring=""""></field><field id=""1039943"" type=""4"" name=""DeDuped Paths"" formatstring=""""><oldValue></oldValue></field><field id=""1039944"" type=""4"" name=""Title"" formatstring=""""><oldValue></oldValue></field><field id=""1039951"" type=""0"" name=""Author"" formatstring=""""><oldValue></oldValue></field><field id=""1039952"" type=""4"" name=""EMAIL BCC (SMTP&#160;Address)"" formatstring=""""><oldValue></oldValue></field><field id=""1039953"" type=""4"" name=""Email CC (SMTP Address)"" formatstring=""""><oldValue></oldValue></field><field id=""1039954"" type=""4"" name=""Child MD5 Hash Values"" formatstring=""""><oldValue></oldValue></field><field id=""1039955"" type=""4"" name=""Child SHA1 Hash Values"" formatstring=""""><oldValue></oldValue></field><field id=""1039956"" type=""4"" name=""Child SHA256 Hash Values"" formatstring=""""><oldValue></oldValue></field><field id=""1039957"" type=""4"" name=""Comments"" formatstring=""""><oldValue></oldValue></field><field id=""1039958"" type=""0"" name=""Company"" formatstring=""""><oldValue></oldValue></field><field id=""1039959"" type=""3"" name=""Contains Embedded Files"" formatstring=""""><oldValue>False</oldValue></field><field id=""1039960"" type=""2"" name=""Date/Time Last Saved"" formatstring=""g""><oldValue></oldValue></field><field id=""1039961"" type=""4"" name=""Document Subject"" formatstring=""""><oldValue></oldValue></field><field id=""1039962"" type=""3"" name=""Unprocessable"" formatstring=""""><oldValue>False</oldValue></field><field id=""1039963"" type=""4"" name=""Unified Title"" formatstring=""""><oldValue><![CDATA[0267bg.jpg]]></oldValue></field><field id=""1039964"" type=""3"" name=""Track Changes"" formatstring=""""><oldValue></oldValue></field><field id=""1039965"" type=""2"" name=""Date/Time Email Created"" formatstring=""g""><oldValue></oldValue></field><field id=""1039966"" type=""2"" name=""Email Last Modified Date/Time"" formatstring=""g""><oldValue></oldValue></field><field id=""1039967"" type=""2"" name=""Image Taken Date/Time"" formatstring=""g""><oldValue></oldValue></field><field id=""1039968"" type=""2"" name=""Date/Time Last Accessed"" formatstring=""g""><oldValue>2018-02-01 18:38:43</oldValue></field><field id=""1039969"" type=""2"" name=""Meeting End Date/Time"" formatstring=""g""><oldValue></oldValue></field><field id=""1039970"" type=""2"" name=""Meeting Start Date/Time"" formatstring=""g""><oldValue></oldValue></field><field id=""1039971"" type=""2"" name=""Primary Date/Time"" formatstring=""g""><oldValue>2005-03-29 13:39:06</oldValue></field><field id=""1039972"" type=""0"" name=""Email Store Name"" formatstring=""""><oldValue></oldValue></field><field id=""1039973"" type=""0"" name=""Last Saved By"" formatstring=""""><oldValue></oldValue></field><field id=""1039974"" type=""0"" name=""MS Office Document Manager"" formatstring=""""><oldValue></oldValue></field><field id=""1039975"" type=""0"" name=""MS Office Revision Number"" formatstring=""""><oldValue></oldValue></field><field id=""1039976"" type=""0"" name=""Message ID"" formatstring=""""><oldValue></oldValue></field><field id=""1039977"" type=""0"" name=""Original Author Name"" formatstring=""""><oldValue></oldValue></field><field id=""1039978"" type=""0"" name=""Original Email Author"" formatstring=""""><oldValue></oldValue></field><field id=""1039979"" type=""0"" name=""Original File Extension"" formatstring=""""><oldValue><![CDATA[JPG]]></oldValue></field><field id=""1039980"" type=""0"" name=""Parent Document ID"" formatstring=""""><oldValue><![CDATA[ABE0575553]]></oldValue></field><field id=""1039981"" type=""0"" name=""SHA1 Hash"" formatstring=""""><oldValue><![CDATA[AD5FDC61B8856C4EF7BAC2B318FC5BEF2C26BDCD]]></oldValue></field><field id=""1039982"" type=""0"" name=""SHA256 Hash"" formatstring=""""><oldValue><![CDATA[96AC13CFD577ED953F257C87DEBC280734E255EF69AE0D175200101640C3C95A]]></oldValue></field><field id=""1039983"" type=""0"" name=""Sender Name"" formatstring=""""><oldValue></oldValue></field><field id=""1039984"" type=""13"" name=""Recipient Domains (BCC)"" formatstring=""""></field><field id=""1039987"" type=""13"" name=""Recipient Domains (CC)"" formatstring=""""></field><field id=""1039990"" type=""13"" name=""Recipient Domains (To)"" formatstring=""""></field><field id=""1039993"" type=""13"" name=""Sender Domain"" formatstring=""""></field><field id=""1039996"" type=""5"" name=""Email Format"" formatstring=""""></field><field id=""1039997"" type=""5"" name=""Email Sensitivity"" formatstring=""""></field><field id=""1039998"" type=""5"" name=""Importance"" formatstring=""""></field><field id=""1039999"" type=""5"" name=""Media Type"" formatstring=""""><unsetChoice>1040067</unsetChoice></field><field id=""1040000"" type=""5"" name=""Message Class"" formatstring=""""></field><field id=""1040001"" type=""5"" name=""Message Type"" formatstring=""""></field><field id=""1040002"" type=""5"" name=""Outlook Flag Status"" formatstring=""""></field><field id=""1040003"" type=""5"" name=""Password Protected"" formatstring=""""></field><field id=""1040004"" type=""5"" name=""Record Type"" formatstring=""""><unsetChoice>1040062</unsetChoice></field><field id=""1040005"" type=""5"" name=""Text Extraction Method"" formatstring=""""><unsetChoice>1085544</unsetChoice></field><field id=""1040006"" type=""1"" name=""Recipient Count"" formatstring=""""><oldValue>0</oldValue></field><field id=""1040007"" type=""3"" name=""Email Has Attachments"" formatstring=""""><oldValue></oldValue></field><field id=""1040008"" type=""3"" name=""Email Modified Flag"" formatstring=""""><oldValue></oldValue></field><field id=""1040009"" type=""3"" name=""Email Sent Flag"" formatstring=""""><oldValue></oldValue></field><field id=""1040010"" type=""3"" name=""Email Unread"" formatstring=""""><oldValue></oldValue></field><field id=""1040011"" type=""3"" name=""Excel Hidden Columns"" formatstring=""""><oldValue></oldValue></field><field id=""1040012"" type=""3"" name=""Excel Hidden Rows"" formatstring=""""><oldValue></oldValue></field><field id=""1040013"" type=""3"" name=""Excel Hidden Worksheets"" formatstring=""""><oldValue></oldValue></field><field id=""1040014"" type=""3"" name=""Excel Pivot Tables"" formatstring=""""><oldValue></oldValue></field><field id=""1040015"" type=""3"" name=""Has Hidden Data"" formatstring=""""><oldValue></oldValue></field><field id=""1040016"" type=""3"" name=""Has OCR Text"" formatstring=""""><oldValue></oldValue></field><field id=""1040017"" type=""3"" name=""Is Embedded"" formatstring=""""><oldValue>False</oldValue></field><field id=""1040018"" type=""3"" name=""Is Parent"" formatstring=""""><oldValue>False</oldValue></field><field id=""1040019"" type=""3"" name=""PowerPoint Hidden Slides"" formatstring=""""><oldValue></oldValue></field><field id=""1040020"" type=""3"" name=""Read Receipt Requested"" formatstring=""""><oldValue></oldValue></field><field id=""1040021"" type=""3"" name=""Speaker Notes"" formatstring=""""><oldValue></oldValue></field><field id=""1040022"" type=""3"" name=""Suspect File Extension"" formatstring=""""><oldValue>False</oldValue></field><field id=""1040023"" type=""4"" name=""Document Title"" formatstring=""""><oldValue></oldValue></field><field id=""1040024"" type=""4"" name=""Email Categories"" formatstring=""""><oldValue></oldValue></field><field id=""1040025"" type=""4"" name=""Email Entry ID"" formatstring=""""><oldValue></oldValue></field><field id=""1040026"" type=""4"" name=""Email Folder Path"" formatstring=""""><oldValue></oldValue></field><field id=""1040027"" type=""4"" name=""Email In Reply To ID"" formatstring=""""><oldValue></oldValue></field><field id=""1040028"" type=""0"" name=""From (SMTP Address)"" formatstring=""""><oldValue></oldValue></field><field id=""1040029"" type=""4"" name=""Keywords"" formatstring=""""><oldValue></oldValue></field><field id=""1040030"" type=""4"" name=""Date Last Accessed"" formatstring=""""><oldValue><![CDATA[2/1/2018]]></oldValue></field><field id=""1040031"" type=""4"" name=""Last Accessed Time"" formatstring=""""><oldValue><![CDATA[06:38:43 PM]]></oldValue></field><field id=""1040032"" type=""4"" name=""Date Last Modified"" formatstring=""""><oldValue><![CDATA[3/29/2005]]></oldValue></field><field id=""1040033"" type=""4"" name=""Last Modified Time"" formatstring=""""><oldValue><![CDATA[01:39:06 PM]]></oldValue></field><field id=""1040034"" type=""4"" name=""Date Last Printed"" formatstring=""""><oldValue></oldValue></field><field id=""1040035"" type=""4"" name=""Last Printed Time"" formatstring=""""><oldValue></oldValue></field><field id=""1040036"" type=""4"" name=""Date Last Saved"" formatstring=""""><oldValue></oldValue></field><field id=""1040037"" type=""4"" name=""Last Saved Time"" formatstring=""""><oldValue></oldValue></field><field id=""1040038"" type=""4"" name=""Meeting End Date"" formatstring=""""><oldValue></oldValue></field><field id=""1040039"" type=""4"" name=""Meeting End Time"" formatstring=""""><oldValue></oldValue></field><field id=""1040040"" type=""4"" name=""Meeting Start Date"" formatstring=""""><oldValue></oldValue></field><field id=""1040041"" type=""4"" name=""Meeting Start Time"" formatstring=""""><oldValue></oldValue></field><field id=""1040042"" type=""4"" name=""Message Header"" formatstring=""""><oldValue></oldValue></field><field id=""1040043"" type=""4"" name=""Native File"" formatstring=""""><oldValue><![CDATA[\\files\T002\Files\EDDS6090819\Processing\1114797\INV6090819\SOURCE\369\739943.JPG]]></oldValue></field><field id=""1040044"" type=""4"" name=""Other Metadata"" formatstring=""""><oldValue><![CDATA[Image/Comments/Comment=˜;HiddenAttachment=True]]></oldValue></field><field id=""1040045"" type=""4"" name=""Date Received"" formatstring=""""><oldValue></oldValue></field><field id=""1040046"" type=""4"" name=""Received Time"" formatstring=""""><oldValue></oldValue></field><field id=""1040047"" type=""4"" name=""Recipient Name (To)"" formatstring=""""><oldValue></oldValue></field><field id=""1040048"" type=""4"" name=""Date Sent"" formatstring=""""><oldValue></oldValue></field><field id=""1040049"" type=""4"" name=""Time Sent"" formatstring=""""><oldValue></oldValue></field><field id=""1040050"" type=""4"" name=""Source Path"" formatstring=""""><oldValue><![CDATA[\JBush_New_Source\2016-10-04_20-42-09UTC\JBush\C\!Misc\Jeb Bush Emails.rar\Jeb Bush Emails\2005a_Jan-Mar_GovernFShiavo.pst\FromAutoForward\FromAutoForward1\Jeb, ya deserve a pat on the back........................]]></oldValue></field><field id=""1040051"" type=""4"" name=""Email To (SMTP Address)"" formatstring=""""><oldValue></oldValue></field><field id=""1042326"" type=""5"" name=""Parent Duplicate"" formatstring=""""></field><field id=""1042327"" type=""5"" name=""Document Duplicate"" formatstring=""""></field><field id=""1042334"" type=""4"" name=""All Custodians (Script)"" formatstring=""""><oldValue></oldValue></field><field id=""1042335"" type=""4"" name=""All Source Locations (Script)"" formatstring=""""><oldValue></oldValue></field><field id=""1042431"" type=""4"" name=""Email Author Date ID"" formatstring=""""><oldValue></oldValue></field><field id=""1042441"" type=""0"" name=""Email Thread Hash"" formatstring=""""><oldValue></oldValue></field><field id=""1042588"" type=""8"" name=""Structured Analytics Sets"" formatstring=""""></field><field id=""1093271"" type=""3"" name=""Has Been Transcoded"" formatstring=""""><oldValue></oldValue></field><field id=""1093272"" type=""4"" name=""Human Transcribed Text"" formatstring=""""><oldValue></oldValue></field><field id=""1093273"" type=""0"" name=""Veritone Recording ID"" formatstring=""""><oldValue></oldValue></field><field id=""1093274"" type=""6"" name=""Media Duration"" formatstring=""""><oldValue></oldValue></field><field id=""1093275"" type=""4"" name=""Machine Transcribed Text"" formatstring=""""><oldValue></oldValue></field><field id=""1093276"" type=""2"" name=""Human Transcription Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093277"" type=""2"" name=""Machine Transcription Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093278"" type=""4"" name=""Machine Transcription Metadata"" formatstring=""""><oldValue></oldValue></field><field id=""1093279"" type=""4"" name=""Human Transcription Metadata"" formatstring=""""><oldValue></oldValue></field><field id=""1093280"" type=""4"" name=""Transcription Metadata Demo"" formatstring=""""><oldValue></oldValue></field><field id=""1093281"" type=""4"" name=""Transcribed Text Demo"" formatstring=""""><oldValue></oldValue></field><field id=""1093282"" type=""3"" name=""Being Transcoded"" formatstring=""""><oldValue></oldValue></field><field id=""1093283"" type=""5"" name=""Machine Transcription Status"" formatstring=""""></field><field id=""1093289"" type=""5"" name=""Human Transcription Status"" formatstring=""""></field><field id=""1093295"" type=""0"" name=""Media File Name"" formatstring=""""><oldValue></oldValue></field><field id=""1093296"" type=""0"" name=""Media File Extension"" formatstring=""""><oldValue></oldValue></field><field id=""1093313"" type=""8"" name=""Cluster :: All Documents"" formatstring=""""></field><field id=""1093315"" type=""6"" name=""Cluster :: All Documents :: Score"" formatstring=""""><oldValue></oldValue></field><field id=""1093411"" type=""0"" name=""Record Num"" formatstring=""""><oldValue></oldValue></field><field id=""1093412"" type=""2"" name=""NARA Release Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093413"" type=""5"" name=""Formerly Withheld"" formatstring=""""></field><field id=""1093414"" type=""0"" name=""Agency"" formatstring=""""><oldValue></oldValue></field><field id=""1093415"" type=""2"" name=""Doc Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093416"" type=""0"" name=""File Num"" formatstring=""""><oldValue></oldValue></field><field id=""1093417"" type=""0"" name=""To Name"" formatstring=""""><oldValue></oldValue></field><field id=""1093418"" type=""0"" name=""From Name"" formatstring=""""><oldValue></oldValue></field><field id=""1093419"" type=""1"" name=""Num Pages"" formatstring=""""><oldValue></oldValue></field><field id=""1093420"" type=""0"" name=""Originator"" formatstring=""""><oldValue></oldValue></field><field id=""1093421"" type=""0"" name=""Record Series"" formatstring=""""><oldValue></oldValue></field><field id=""1093422"" type=""2"" name=""Review Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093423"" type=""1"" name=""Pages Released"" formatstring=""""><oldValue></oldValue></field><field id=""1093424"" type=""0"" name=""DocType"" formatstring=""""><oldValue></oldValue></field><field id=""1093427"" type=""0"" name=""DocDate2"" formatstring=""""><oldValue></oldValue></field><field id=""1093676"" type=""4"" name=""Fact Excerpt"" formatstring=""""><oldValue></oldValue></field><field id=""1093677"" type=""2"" name=""Fact Primary Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093678"" type=""2"" name=""Fact End Date"" formatstring=""g""><oldValue></oldValue></field><field id=""1093679"" type=""0"" name=""Fact"" formatstring=""""><oldValue></oldValue></field><field id=""1093680"" type=""5"" name=""Fact Date Type"" formatstring=""""></field><field id=""1093684"" type=""4"" name=""Fact Description"" formatstring=""""><oldValue></oldValue></field><field id=""1093685"" type=""13"" name=""Organizations"" formatstring=""""></field><field id=""1093688"" type=""13"" name=""Document Fact"" formatstring=""""></field><field id=""1093691"" type=""13"" name=""Document Issues"" formatstring=""""></field><field id=""1093694"" type=""13"" name=""People"" formatstring=""""></field><field id=""1093697"" type=""13"" name=""Interview Question Facts"" formatstring=""""></field><field id=""1093700"" type=""0"" name=""FM-Issue"" formatstring=""""><oldValue></oldValue></field><field id=""1093701"" type=""0"" name=""FM-Organization"" formatstring=""""><oldValue></oldValue></field><field id=""1093702"" type=""0"" name=""FM-Interview Question"" formatstring=""""><oldValue></oldValue></field><field id=""1093703"" type=""0"" name=""FM-First Name"" formatstring=""""><oldValue></oldValue></field><field id=""1093704"" type=""0"" name=""FM-Last Name"" formatstring=""""><oldValue></oldValue></field><field id=""1093705"" type=""13"" name=""Documents"" formatstring=""""></field><field id=""1111502"" type=""13"" name=""STR - Dallas STR"" formatstring=""""></field><field id=""1111505"" type=""13"" name=""STR - Dallas STR - Unique"" formatstring=""""></field><field id=""1112297"" type=""3"" name=""Converted Email Format"" formatstring=""""><oldValue></oldValue></field><field id=""2119434"" type=""13"" name=""Document Error"" formatstring=""""></field><field id=""2120096"" type=""5"" name=""Has Media Redactions"" formatstring=""""></field><field id=""2120101"" type=""4"" name=""Machine Transcription VLF Metadata"" formatstring=""""><oldValue></oldValue></field><field id=""2120102"" type=""3"" name=""Transcoder Warning"" formatstring=""""><oldValue></oldValue></field><field id=""2120103"" type=""4"" name=""Veritone Redacted Text"" formatstring=""""><oldValue></oldValue></field><field id=""2120104"" type=""2"" name=""Machine Translation Date"" formatstring=""g""><oldValue></oldValue></field><field id=""2120105"" type=""2"" name=""Human Translation Date"" formatstring=""g""><oldValue></oldValue></field><field id=""2120106"" type=""5"" name=""Human Translation Status"" formatstring=""""></field><field id=""2120112"" type=""5"" name=""Machine Translation Status"" formatstring=""""></field><field id=""2120118"" type=""3"" name=""Set Redacted Copy as Native"" formatstring=""""><oldValue></oldValue></field><field id=""2120119"" type=""4"" name=""Human Transcription VLF Metadata"" formatstring=""""><oldValue></oldValue></field><field id=""2120120"" type=""5"" name=""Object Detection Status"" formatstring=""""></field><field id=""2120125"" type=""2"" name=""Object Detection Date"" formatstring=""g""><oldValue></oldValue></field><field id=""2120126"" type=""4"" name=""Object Detection Metadata"" formatstring=""""><oldValue></oldValue></field><field id=""2120955"" type=""0"" name=""Native Imaging Warning"" formatstring=""""><oldValue></oldValue></field></auditElement>
";

		private const string ProblematicAuditC =
			@"<auditElement><RecordOrigination><MAC>00:0D:3A:92:79:60</MAC><IP>10.10.12.165</IP><Server>VM-T002WEB002</Server></RecordOrigination></auditElement>";

		private const string ProblematicAuditD =
			@"<auditElement><QueryText>/* &lt;Comments&gt;    &lt;ArtifactID&gt;1003684&lt;/ArtifactID&gt;    &lt;ArtifactTypeID&gt;10&lt;/ArtifactTypeID&gt;    &lt;UserID&gt;6193320&lt;/UserID&gt;    &lt;WorkspaceID&gt;1079716&lt;/WorkspaceID&gt;    &lt;QueryType&gt;IdList&lt;/QueryType&gt;    &lt;QueryID&gt;673f07d8-c643-4d30-a5a3-cd2a5f1e37af&lt;/QueryID&gt;    &lt;QuerySource&gt;View or Search&lt;/QuerySource&gt;  &lt;/Comments&gt; */    SET NOCOUNT ON   ;WITH  [SEARCHTABLE_1] AS (SELECT [Key], [RANK] FROM CONTAINSTABLE([Document],([ControlNumber],[ExtractedText],[GroupIdentifier]),'""Test""'))  SELECT TOP 5000   [Document].[ArtifactID],   CAST([SEARCHTABLE_1].[Rank] AS FLOAT) AS [Rank]    FROM   [Document] (NOLOCK)  LEFT JOIN [SEARCHTABLE_1] ON    [SEARCHTABLE_1].[Key] = [Document].[ArtifactID]  WHERE  [SEARCHTABLE_1].[RANK] &gt;= 1  AND  [Document].[AccessControlListID_D] IN (1,1000056,1000058,1001076)  ORDER BY    [Document].[ControlNumber] ASC, [Document].[ArtifactID] ASC      -------------------  -- records returned: 0  -------------------  </QueryText><ErrorMessage>Invalid search query - Cannot use a CONTAINS or FREETEXT predicate on column 'ExtractedText' because it is not full-text indexed.&#xB;kCura.Data.RowDataGateway.ExecuteSQLStatementFailedException: SQL Statement Failed ---&gt; System.Data.SqlClient.SqlException: Cannot use a CONTAINS or FREETEXT predicate on column 'ExtractedText' because it is not full-text indexed.     at kCura.Data.RowDataGateway.Helper.ExecuteQueryWithRetryOnDeadlock[T](Func`1 executeQuery, SqlExecutionLogger logger)     at kCura.Data.RowDataGateway.Context.ExecuteSqlStatementAsDataTable(String sqlStatement, IEnumerable`1 params, Int32 timeoutValue, Boolean retryWithoutHashJoin)     --- End of inner exception stack trace ---     at kCura.Data.RowDataGateway.Context.ExecuteSqlStatementAsDataTable(String sqlStatement, IEnumerable`1 params, Int32 timeoutValue, Boolean retryWithoutHashJoin)     at Relativity.Data.QueryExecutor.ExecuteQuery(Query query, ExecuteAsDataTableStrategy executeStrategy, Nullable`1 maxFieldDisplayLength)  SQL Statement Failed:  /* &lt;Comments&gt;    &lt;ArtifactID&gt;1003684&lt;/ArtifactID&gt;    &lt;ArtifactTypeID&gt;10&lt;/ArtifactTypeID&gt;    &lt;UserID&gt;6193320&lt;/UserID&gt;    &lt;WorkspaceID&gt;1079716&lt;/WorkspaceID&gt;    &lt;QueryType&gt;IdList&lt;/QueryType&gt;    &lt;QueryID&gt;673f07d8-c643-4d30-a5a3-cd2a5f1e37af&lt;/QueryID&gt;    &lt;QuerySource&gt;View or Search&lt;/QuerySource&gt;  &lt;/Comments&gt; */    SET NOCOUNT ON   ;WITH  [SEARCHTABLE_1] AS (SELECT [Key], [RANK] FROM CONTAINSTABLE([Document],([ControlNumber],[ExtractedText],[GroupIdentifier]),'""Test""'))  SELECT TOP 5000   [Document].[ArtifactID],   CAST([SEARCHTABLE_1].[Rank] AS FLOAT) AS [Rank]    FROM   [Document] (NOLOCK)  LEFT JOIN [SEARCHTABLE_1] ON    [SEARCHTABLE_1].[Key] = [Document].[ArtifactID]  WHERE  [SEARCHTABLE_1].[RANK] &gt;= 1  AND  [Document].[AccessControlListID_D] IN (1,1000056,1000058,1001076)  ORDER BY    [Document].[ControlNumber] ASC, [Document].[ArtifactID] ASC  </ErrorMessage><Milliseconds>55</Milliseconds><searchTableReplacements><R1>CONTAINSTABLE([Document],([ControlNumber],[ExtractedText],[GroupIdentifier]),'""Test""') = CONTAINSTABLE([Document],([ControlNumber],[ExtractedText],[GroupIdentifier]),'""Test""')</R1><QueryParameters /></searchTableReplacements></auditElement>";
	}
}
